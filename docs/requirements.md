# worktree間でファイルを共有するCLIツール

ステータス: 未着手
優先度: 低

一旦gqhのルートディレクトリにclaude.mdと関連するファイルをおいて、それぞれのディレクトリにシンボリックリンクを追加するのが良さそう。

### **ワークツリーファイル同期ツール 要件定義書 (改訂版)**

### **1. 概要**

本ドキュメントは、単一のGitリポジトリから派生した複数のワークツリー間で、特定のファイル群を効率的に共有・同期させるCLIツールの要件を定義する。

このツールは **Git の機能を通じて動作環境を動的に検出**するため、物理的なディレクトリの配置や命名規則に依存せず、柔軟な開発環境をサポートする。

---

### **2. 背景と目的**

背景:

git worktree を利用した開発では、複数のブランチを同時にチェックアウトして作業できるため、並行開発の効率が向上する。しかし、各ワークツリーは独立したディレクトリであるため、docker-compose.yml や .env、IDEの設定ファイルなど、全ワークツリーで共通利用したい設定ファイルが分散し、手動でのコピーや同期が必要になる。この手作業は非効率であり、設定の不整合や更新漏れといったヒューマンエラーの原因となる。

**目的:**

- ワークツリー間のファイル共有・同期プロセスを**自動化**する。
- 設定ファイルを**一元管理**（Single Source of Truth）し、設定の不整合を防ぐ。
- 新しいワークツリー作成後のセットアップ手順を**簡略化・標準化**する。

---

### **3. スコープ**

### **スコープ内（本ツールが担当する範囲）**

- 設定ファイルに基づき、指定されたファイル群をワークツリー間で同期する機能。
- ファイル同期方式として**シンボリックリンク**の作成を主たる方法とする。
- Gitコマンドを利用して、任意のリポジトリに紐づく全てのワークツリーを**場所を問わず**自動検出する機能。
- 開発者が手動で実行するための**CLI（コマンドラインインターフェース）**の提供。

### **スコープ外（本ツールが担当しない範囲）**

- `git worktree` コマンドそのものの機能（ワークツリーの作成、削除など）。
- ファイル内容のマージや差分同期。
- Gitリポジトリ自体の管理（commit, push, pullなど）。

---

### **4. 機能要件**

| ID | 要件名 | 詳細 |
| --- | --- | --- |
| **FR-1** | **設定ファイルに基づく動作** | どのファイルを共有するかを定義した設定ファイルをリポジトリのルートに配置できること。`package.json`内の専用キー、または`.worktreeshare.json`のような独立したファイル形式をサポートする。 |
| **FR-2** | **リポジトリルートの動的検出** | `git rev-parse --show-toplevel` コマンドの実行結果に基づき、リポジトリのルートディレクトリを動的に特定する。これにより、コマンドをどこで実行しても、常に正しい基点を把握する。 |
| **FR-3** | **ワークツリーの動的・自動検出** | `git worktree list` コマンドの実行結果を解析し、リポジトリに紐づく全てのワークツリーの絶対パスを自動で検出する。これにより、ワークツリーがファイルシステムのどこに存在していても、処理対象とすることができる。 |
| **FR-4** | **同期処理の実行** | 検出した全てのワークツリーに対し、設定ファイルで指定されたファイルのシンボリックリンクを作成・更新する。処理は**冪等（べきとう）**であること（複数回実行しても結果が同じになる）。 |
| **FR-5** | **原本ファイルの一元管理** | 設定で指定された「原本ディレクトリ」（例: `<git-root>/.shared-files/`）に共有ファイルの原本を配置する。ツールは各ワークツリーからこの原本ファイルへのシンボリックリンクを貼る。 |
| **FR-6** | **CLIの提供** | 開発者がターミナルから `npx sync-worktrees` のような単一のコマンドで同期処理を実行できること。 |
| **FR-7** | **ドライラン（プレビュー）機能** | 実際にファイルの操作（シンボリックリンク作成・削除）を行わず、実行される処理内容をコンソールに表示する `--dry-run` オプションを提供すること。 |

---

### **5. 非機能要件**

| ID | 要件名 | 詳細 |
| --- | --- | --- |
| **NFR-1** | **構成の柔軟性** | 特定のディレクトリ名や階層構造（例: `../<project>`）に依存しない。全てのパス解決は、Gitコマンドによって動的に取得した絶対パスを基に行う。 |
| **NFR-2** | **ユーザビリティ** | 実行結果（どのワークツリーに、どのリンクを作成したか）がコンソールに分かりやすく表示されること。エラー発生時には、原因究明に繋がる明確なメッセージを表示すること。 |
| **NFR-3** | **互換性** | 開発者の主要な利用環境である **macOS** 及び **Linux** 上で正常に動作すること。Windowsのシンボリックリンクにも可能な範囲で対応することが望ましい。 |
| **NFR-4** | **パフォーマンス** | 一般的なプロジェクト（ワークツリー10個、共有ファイル20個程度）において、コマンド実行から完了までが数秒以内であること。 |

---

### **6. 前提・制約事項**

本ツールがディレクトリ構成への非依存性を実現するため、利用者は以下の2つの規約に従う必要がある。

1. **設定ファイルの配置場所:** ツールが読み込む設定ファイルは、**必ずリポジトリのルートディレクトリに配置する**。
2. **共有ファイルパスの記述方法:** 設定ファイル内に記述する共有対象のファイルパスは、**必ずリポジトリのルートディレクトリからの相対パスで記述する**。